name: Flutter Simple CI

on:
  push:
    branches:
      - main
      - master
      - dev
  pull_request:
    branches:
      - main
      - master
      - dev

jobs:
  # RÃºt gá»n láº¡i thÃ nh 1 Job duy nháº¥t: Chá»‰ kiá»ƒm tra xem cÃ³ Build ra Ä‘Æ°á»£c App khÃ´ng.
  build_and_check_conflict:
    name: Check Code Conflict & Build
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: ğŸ“š Checkout repository
        uses: actions/checkout@v4

      - name: â˜• Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: 'zulu'
          java-version: '17'
          cache: 'gradle'

      - name: ğŸ¦ Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          cache: true

      - name: ğŸ“¦ Install dependencies
        run: flutter pub get

      - name: âš™ï¸ Setup Environment 
        run: |
          if [ -f ".env.example" ]; then
            cp .env.example .env
          else
            touch .env
          fi

      - name: ğŸ—ï¸ Run build_runner
        # Sinh file cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»ƒ chá»‘ng lá»—i thiáº¿u class khi build
        run: dart run build_runner build --delete-conflicting-outputs

      # Táº¡m thá»i bá» Ä‘i cÃ¡c bÆ°á»›c kháº¯t khe (Format vÃ  Analyze) Ä‘á»ƒ CI thá»Ÿ dá»… hÆ¡n
      # Sáº½ khÃ´ng rá»›t CI chá»‰ vÃ¬ quÃªn cÃ¡ch dÃ²ng hay thá»«a 1 biáº¿n sá»‘.

      - name: ğŸ› ï¸ Build Debug APK
        # Náº¿u lá»‡nh nÃ y thÃ nh cÃ´ng -> Code hoáº¡t Ä‘á»™ng, khÃ´ng bá»‹ xung Ä‘á»™t thÆ° viá»‡n
        run: flutter build apk --debug
